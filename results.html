<!DOCTYPE html>
<html>

<head>
    <link href="https://fonts.googleapis.com/css?family=Montserrat:300,400,700%7CRoboto:400,700" rel="stylesheet">
    <link href='style.css' rel='stylesheet' type='text/css'>
    <title>FascistValues Results</title>
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="shortcut icon" type="image/png" href="icon.png">
    <meta charset="utf-8">
    <script type="application/javascript" src="ideologies.js">
    </script>
</head>

<body>
    <h1>FascistValues</h1>
    <select id="langPicker"></select>
    <hr>

    <h1 data-i18n="result_h1">Results</h1>

    <h2><span class="weight-300" id="a-label"></span></h2>
    <div class="axis">
        <img id="img-left" src="value_images/left.png" height="128pt" />
        <div class="bar left" id="bar-left">
            <div class="text-wrapper" id="left"></div>
        </div>
        <div class="bar right" id="bar-right">
            <div class="text-wrapper" id="right"></div>
        </div>
        <img id="img-right" src="value_images/right.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="b-label"></span></h2>
    <div class="axis">
        <img id="img-totalitarian" src="value_images/totalitarian.png" height="128pt" />
        <div class="bar totalitarian" id="bar-totalitarian">
            <div class="text-wrapper" id="totalitarian"></div>
        </div>
        <div class="bar moderate" id="bar-moderate">
            <div class="text-wrapper" id="moderate"></div>
        </div>
        <img id="img-moderate" src="value_images/moderate.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="c-label"></span></h2>
    <div class="axis">
        <img id="img-race" src="value_images/race.png" height="128pt" />
        <div class="bar race" id="bar-race">
            <div class="text-wrapper" id="race"></div>
        </div>
        <div class="bar culture" id="bar-culture">
            <div class="text-wrapper" id="culture"></div>
        </div>
        <img id="img-culture" src="value_images/culture.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="d-label"></span></h2>
    <div class="axis">
        <img id="img-pacifist" src="value_images/pacifist.png" height="128pt" />
        <div class="bar pacifist" id="bar-pacifist">
            <div class="text-wrapper" id="pacifist"></div>
        </div>
        <div class="bar militarist" id="bar-militarist">
            <div class="text-wrapper" id="militarist"></div>
        </div>
        <img id="img-militarist" src="value_images/militarist.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="e-label"></span></h2>
    <div class="axis">
        <img id="img-religion" src="value_images/religion.png" height="128pt" />
        <div class="bar religion" id="bar-religion">
            <div class="text-wrapper" id="religion"></div>
        </div>
        <div class="bar secular" id="bar-secular">
            <div class="text-wrapper" id="secular"></div>
        </div>
        <img id="img-secular" src="value_images/secular.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="f-label"></span></h2>
    <div class="axis">
        <img id="img-industry" src="value_images/industry.png" height="128pt" />
        <div class="bar industry" id="bar-industry">
            <div class="text-wrapper" id="industry"></div>
        </div>
        <div class="bar ecology" id="bar-ecology">
            <div class="text-wrapper" id="ecology"></div>
        </div>
        <img id="img-ecology" src="value_images/ecology.png" height="128pt" />
    </div>
    <h2><span class="weight-300" id="g-label"></span></h2>
    <div class="axis">
        <img id="img-reactionary" src="value_images/reactionary.png" height="128pt" />
        <div class="bar reactionary" id="bar-reactionary">
            <div class="text-wrapper" id="reactionary"></div>
        </div>
        <div class="bar progressive" id="bar-progressive">
            <div class="text-wrapper" id="progressive"></div>
        </div>
        <img id="img-progressive" src="value_images/progressive.png" height="128pt" />
    </div>
    <h2 data-i18n="result_h2_match">Closest Match:<span class="weight-300" id="ideology-label"></span></h2>
    <h3><span class="weight-300" id="ideodesc-label"></span></h3>
    <p data-i18n="result_url"><br>You can send these results by copying and pasting the URL at the top of the page or
        using the image below.</p>

    <h2 data-i18n="result_h2_next_matches">Next closest matches</h2>
    <p data-i18n="next_matches_percent">With your closest match as 100% and farthest as 0%, here is how closely you
        matched the other ideologies.</p>

    <dl id="next-matches"></dl>

    <h2 data-i18n="result_h2_score">I don't like my scores!</h2>
    <p data-i18n="result_issues">Please remember that you are not intended to get a 100% score in any of the categories.
        The point of the quiz is to challenge your views. If you have any suggestions or constructive criticism please
        fill out this <a href="https://forms.gle/6WZYMb5GXkkDLhxr5">short form</a> or open an issue on the <a
            href="https://github.com/fascistvalues/fascistvalues.github.io">GitHub Page</a>.</p>
    <hr />
    <canvas id="banner" width=800 height=1000 style="font-family:Montserrat"></canvas>
    <button data-i18n="result_back" class="button" onclick="location.href='index.html';"
        style="background-color: #2196f3;">Back</button> <br>
    <!-- Privacy respecting Statcounter code for LeftValues https://github.com/fascistvalues/fascistvalues.github.io -->
    <script type="text/javascript">
        var sc_project = 12079783;
        var sc_invisible = 1;
        var sc_security = "f3285a9d";
        var sc_https = 1;
        if (navigator.doNotTrack != 1) {
            var statcounterscript = document.createElement('script');
            statcounterscript.setAttribute("type", "text/javascript");
            statcounterscript.setAttribute("src", "https://www.statcounter.com/counter/counter.js");
            document.getElementsByTagName("body")[0].appendChild(statcounterscript);
        }
    </script>
    <!-- End of Statcounter Code -->
    <!-- JavaScript for the test itself -->
    <script type="application/javascript" src="i18n.js"></script>
    <script>
        /* global i18n, loadTranslation, ideologies */
        function getQueryVariable (variable) {
        var query = window.location.search.substring(1)
        var vars = query.split('&')
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split('=')
            if (pair[0] === variable) {
            return pair[1]
            }
        }
        return (NaN)
        }

        function setBarValue (name, value) {
        const innerel = document.getElementById(name)
        const outerel = document.getElementById('bar-' + name)
        outerel.style.width = (value + '%')
        innerel.innerHTML = (value + '%')
        if (innerel.offsetWidth + 20 > outerel.offsetWidth) {
            innerel.style.visibility = 'hidden'
        }
        }

        function setLabel (val, ary) {
        ary = ary.split(',')
        if (val > 100) {
            return ''
        } else
        if (val > 90) {
            return ary[0]
        } else
        if (val > 75) {
            return ary[1]
        } else
        if (val > 60) {
            return ary[2]
        } else
        if (val >= 40) {
            return ary[3]
        } else
        if (val >= 25) {
            return ary[4]
        } else
        if (val >= 10) {
            return ary[5]
        } else
        if (val >= 0) {
            return ary[6]
        } else {
            return ''
        }
        }

        function getIdeologyNameByIndex (name) {
        return i18n.getString(`ideology_${name}_name`)
        }

        function getIdeologyDescriptionByIndex (name) {
        return i18n.getString(`ideology_${name}_desc`)
        }

        const left = getQueryVariable('a')
        const totalitarian = getQueryVariable('b')
        const race = getQueryVariable('c')
        const pacifist = getQueryVariable('d')
        const religion = getQueryVariable('e')
        const industry = getQueryVariable('f')
        const reactionary = getQueryVariable('g')
        const right = (100 - left).toFixed(1)
        const moderate = (100 - totalitarian).toFixed(1)
        const culture = (100 - race).toFixed(1)
        const militarist = (100 - pacifist).toFixed(1)
        const secular = (100 - religion).toFixed(1)
        const ecology = (100 - industry).toFixed(1)
        const progressive = (100 - reactionary).toFixed(1)

        setBarValue('left', left)
        setBarValue('right', right)
        setBarValue('moderate', moderate)
        setBarValue('totalitarian', totalitarian)
        setBarValue('race', race)
        setBarValue('culture', culture)
        setBarValue('militarist', militarist)
        setBarValue('pacifist', pacifist)
        setBarValue('religion', religion)
        setBarValue('secular', secular)
        setBarValue('industry', industry)
        setBarValue('ecology', ecology)
        setBarValue('reactionary', reactionary)
        setBarValue('progressive', progressive)

        loadTranslation().then(() => {
            document.getElementById('a-label').innerHTML = setLabel(left, i18n.getString(
                'result_a_label'))
            document.getElementById('b-label').innerHTML = setLabel(totalitarian, i18n.getString(
                'result_b_label'))
            document.getElementById('c-label').innerHTML = setLabel(race, i18n.getString('result_c_label'))
            document.getElementById('d-label').innerHTML = setLabel(pacifist, i18n.getString(
                'result_d_label'))
            document.getElementById('e-label').innerHTML = setLabel(religion, i18n.getString('result_e_label'))
            document.getElementById('f-label').innerHTML = setLabel(industry, i18n.getString('result_f_label'))
            document.getElementById('g-label').innerHTML = setLabel(reactionary, i18n.getString(
                'result_g_label'))

            let ideology = ''
            let ideodesc = ''
            const ideologyIndexAndDistance = []
            var closestMatch = {}

            let index = 0
            for (const name of Object.keys(ideologies)) {
                let dist = 0
                dist += Math.pow(Math.abs(ideologies[name].a - left), 2)
                dist += Math.pow(Math.abs(ideologies[name].c - race), 2)
                dist += Math.pow(Math.abs(ideologies[name].b - totalitarian), 2)
                dist += Math.pow(Math.abs(ideologies[name].d - pacifist), 2)
                dist += Math.pow(Math.abs(ideologies[name].e - religion), 2)
                dist += Math.pow(Math.abs(ideologies[name].f - industry), 2)
                dist += Math.pow(Math.abs(ideologies[name].g - reactionary), 2)

                // ideologyToDistance[name] = dist
                ideologyIndexAndDistance.push({
                distance: dist,
                name,
                index
                })
                index++
            }

            ideologyIndexAndDistance.sort(function (a, b) {
                return a.distance - b.distance
            })

            const distances = ideologyIndexAndDistance.map(function (indexAndDistance) {
                return indexAndDistance.distance
            })

            const closestDistance = distances[0]
            const farthestDistance = distances[distances.length - 1]
            const distanceSpan = farthestDistance - closestDistance

            closestMatch = ideologyIndexAndDistance[0]
            document.getElementById('ideology-label').innerHTML = getIdeologyNameByIndex(closestMatch.name)
            document.getElementById('ideodesc-label').innerHTML = getIdeologyDescriptionByIndex(closestMatch
                .name)

            const nextMatches = document.getElementById('next-matches')
            nextMatches.innerHTML = ideologyIndexAndDistance.slice(1).map(function (indexAndDistance) {
                const name = indexAndDistance.name
                ideology = getIdeologyNameByIndex(name)
                ideodesc = getIdeologyDescriptionByIndex(name)
                const relativeDistance = 1 - (indexAndDistance.distance - closestDistance) /
                                distanceSpan
                const relativeDistancePercent = Math.round(relativeDistance * 1000) / 10
                return '<dt>' + ideology + ': ' + relativeDistancePercent + '%</dt>' +
                                '<dd>' + ideodesc + '</dd>'
            }).join('\n')

            const c = document.getElementById('banner')
            const ctx = c.getContext('2d')
            ctx.fillStyle = '#EEEEEE'
            ctx.fillRect(0, 0, 800, 1000)

            let img = document.getElementById('img-left')
            ctx.drawImage(img, 20, 170, 100, 100)
            img = document.getElementById('img-right')
            ctx.drawImage(img, 680, 170, 100, 100)
            img = document.getElementById('img-totalitarian')
            ctx.drawImage(img, 20, 290, 100, 100)
            img = document.getElementById('img-moderate')
            ctx.drawImage(img, 680, 290, 100, 100)
            img = document.getElementById('img-race')
            ctx.drawImage(img, 20, 410, 100, 100)
            img = document.getElementById('img-culture')
            ctx.drawImage(img, 680, 410, 100, 100)
            img = document.getElementById('img-pacifist')
            ctx.drawImage(img, 20, 530, 100, 100)
            img = document.getElementById('img-militarist')
            ctx.drawImage(img, 680, 530, 100, 100)
            img = document.getElementById('img-religion')
            ctx.drawImage(img, 20, 650, 100, 100)
            img = document.getElementById('img-secular')
            ctx.drawImage(img, 680, 650, 100, 100)
            img = document.getElementById('img-industry')
            ctx.drawImage(img, 20, 770, 100, 100)
            img = document.getElementById('img-ecology')
            ctx.drawImage(img, 680, 770, 100, 100)
            img = document.getElementById('img-reactionary')
            ctx.drawImage(img, 20, 890, 100, 100)
            img = document.getElementById('img-progressive')
            ctx.drawImage(img, 680, 890, 100, 100)

            ctx.fillStyle = '#222222'
            ctx.fillRect(120, 180, 560, 80)
            ctx.fillRect(120, 300, 560, 80)
            ctx.fillRect(120, 420, 560, 80)
            ctx.fillRect(120, 540, 560, 80)
            ctx.fillRect(120, 660, 560, 80)
            ctx.fillRect(120, 780, 560, 80)
            ctx.fillRect(120, 900, 560, 80)
            ctx.fillStyle = '#890000'
            ctx.fillRect(120, 184, 5.6 * left - 2, 72)
            ctx.fillStyle = '#FC5959'
            ctx.fillRect(682 - 5.6 * right, 184, 5.6 * right - 2, 72)
            ctx.fillStyle = '#88232B'
            ctx.fillRect(120, 304, 5.6 * totalitarian - 2, 72)
            ctx.fillStyle = '#7F0037'
            ctx.fillRect(682 - 5.6 * moderate, 304, 5.6 * moderate - 2, 72)
            ctx.fillStyle = '#560000'
            ctx.fillRect(120, 424, 5.6 * race - 2, 72)
            ctx.fillStyle = '#000000'
            ctx.fillRect(682 - 5.6 * culture, 424, 5.6 * culture - 2, 72)
            ctx.fillStyle = '#782F52'
            ctx.fillRect(120, 544, 5.6 * pacifist - 2, 72)
            ctx.fillStyle = '#7F3300'
            ctx.fillRect(682 - 5.6 * militarist, 544, 5.6 * militarist - 2, 72)
            ctx.fillStyle = '#963B33'
            ctx.fillRect(120, 664, 5.6 * religion - 2, 72)
            ctx.fillStyle = '#7F333B'
            ctx.fillRect(682 - 5.6 * secular, 664, 5.6 * secular - 2, 72)
            ctx.fillStyle = '#804E00'
            ctx.fillRect(120, 784, 5.6 * industry - 2, 72)
            ctx.fillStyle = '#76890B'
            ctx.fillRect(682 - 5.6 * ecology, 784, 5.6 * ecology - 2, 72)
            ctx.fillStyle = '#27577A'
            ctx.fillRect(120, 904, 5.6 * reactionary - 2, 72)
            ctx.fillStyle = '#C4A717'
            ctx.fillRect(682 - 5.6 * progressive, 904, 5.6 * progressive - 2, 72)
            ctx.fillStyle = '#222222'
            ctx.font = '700 80px Montserrat'
            ctx.textAlign = 'left'
            ctx.fillText('LeftValues', 20, 90)
            ctx.font = '50px Montserrat'
            ctx.fillText(getIdeologyNameByIndex(closestMatch.name), 20, 140)

            ctx.fillStyle = '#dddddd'
            ctx.textAlign = 'left'
            if (left > 30) {
                ctx.fillText(left + '%', 130, 237.5)
            }
            if (totalitarian > 30) {
                ctx.fillText(totalitarian + '%', 130, 357.5)
            }
            if (race > 30) {
                ctx.fillText(race + '%', 130, 477.5)
            }
            if (pacifist > 30) {
                ctx.fillText(pacifist + '%', 130, 597.5)
            }
            if (religion > 30) {
                ctx.fillText(religion + '%', 130, 717.5)
            }
            if (industry > 30) {
                ctx.fillText(industry + '%', 130, 837.5)
            }
            if (reactionary > 30) {
                ctx.fillText(reactionary + '%', 130, 957.5)
            }
            ctx.textAlign = 'right'
            if (right > 30) {
                ctx.fillText(right + '%', 670, 237.5)
            }
            if (moderate > 30) {
                ctx.fillText(moderate + '%', 670, 357.5)
            }
            if (culture > 30) {
                ctx.fillText(culture + '%', 670, 477.5)
            }
            if (militarist > 30) {
                ctx.fillText(militarist + '%', 670, 597.5)
            }
            if (secular > 30) {
                ctx.fillText(secular + '%', 670, 717.5)
            }
            if (ecology > 30) {
                ctx.fillText(ecology + '%', 670, 837.5)
            }
            if (progressive > 30) {
                ctx.fillText(progressive + '%', 670, 957.5)
            }

            ctx.fillStyle = '#222222'
            ctx.font = '300 30px Montserrat'
            ctx.fillText('leftvalues.github.io', 780, 60)
            ctx.textAlign = 'center'
            ctx.fillText('' + document.getElementById('a-label').innerHTML, 400, 175)
            ctx.fillText('' + document.getElementById('b-label').innerHTML, 400, 295)
            ctx.fillText('' + document.getElementById('c-label').innerHTML, 400, 415)
            ctx.fillText('' + document.getElementById('d-label').innerHTML, 400, 535)
            ctx.fillText('' + document.getElementById('e-label').innerHTML, 400, 655)
            ctx.fillText('' + document.getElementById('f-label').innerHTML, 400, 775)
            ctx.fillText('' + document.getElementById('g-label').innerHTML, 400, 895)
        })
    </script>
</body>

</html>